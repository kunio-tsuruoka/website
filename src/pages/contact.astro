---
import { Header } from '../components/header';
// src/pages/contact.astro
import Layout from '../layouts/layout.astro';
import { PageHero } from '../components/ui/page-hero';
---

<Layout title="お問い合わせ | Beekle">
  <Header client:load />
  <main class="pt-20">
    <!-- Hero Section -->
    <PageHero
      englishTitle="CONTACT"
      title="お問い合わせ"
      subtitle="プロジェクトについてのご相談やお見積もりのご依頼など、お気軽にお問い合わせください。"
    />

    <!-- Contact Form Section -->
    <section class="py-32">
      <div class="container mx-auto px-8">
        <div class="max-w-3xl mx-auto">
          <div class="bg-white rounded-xl shadow-lg p-8 md:p-12">
            <form class="space-y-8">
              <!-- お問い合わせ種別 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="type">
                  お問い合わせ種別 <span class="text-red-500">*</span>
                </label>
                <select
                  id="type"
                  name="type"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                >
                  <option value="">選択してください</option>
                  <option value="web">Webアプリ開発について</option>
                  <option value="mobile">モバイルアプリ開発について</option>
                  <option value="prototype">プロトタイプ・POC作成について</option>
                  <option value="global">海外向けサービス開発について</option>
                  <option value="other">その他のご相談</option>
                </select>
              </div>

              <!-- 会社名 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="company">
                  会社名 <span class="text-gray-500">(任意)</span>
                </label>
                <input
                  type="text"
                  id="company"
                  name="company_name"
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="株式会社Beekle"
                />
              </div>

              <!-- お名前 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="name">
                  お名前 <span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="from_name"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="山田 太郎"
                />
              </div>

              <!-- メールアドレス -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="email">
                  メールアドレス <span class="text-red-500">*</span>
                </label>
                <input
                  type="email"
                  id="email"
                  name="reply_to"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="your-email@example.com"
                />
              </div>

              <!-- 電話番号 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="phone">
                  電話番号 <span class="text-gray-500">(任意)</span>
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="03-1234-5678"
                />
              </div>

              <!-- お問い合わせ内容 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" for="message">
                  お問い合わせ内容 <span class="text-red-500">*</span>
                </label>
                <textarea
                  id="message"
                  name="message"
                  rows="6"
                  required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                  placeholder="具体的な内容をご記入ください"
                ></textarea>
              </div>
              
              <!-- 受信者名（非表示） -->
              <input
                type="hidden"
                name="to_name"
                value="管理者"
              />

              <!-- プライバシーポリシー -->
              <div class="flex items-start">
                <div class="flex items-center h-5">
                  <input
                    id="privacy"
                    name="privacy"
                    type="checkbox"
                    required
                    class="w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500"
                  />
                </div>
                <div class="ml-3">
                  <label class="text-sm text-gray-700" for="privacy">
                    <a href="/privacy" class="text-primary-500 hover:text-primary-400 underline">プライバシーポリシー</a>
                    に同意します
                  </label>
                </div>
              </div>

              <!-- 送信ボタン -->
              <div class="text-center">
                <button
                  type="submit"
                  class="inline-flex justify-center px-8 py-4 bg-primary-500 text-white rounded-full font-bold hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors"
                >
                  送信する
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Other Contact Methods -->
    <section class="py-32 bg-gray-50">
      <div class="container mx-auto px-8">
        <div class="max-w-3xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-16">その他のお問い合わせ方法</h2>
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Email -->
            <div class="bg-white rounded-xl shadow-lg p-8">
              <h3 class="text-xl font-bold text-gray-800 mb-4">メールでのお問い合わせ</h3>
              <p class="text-gray-600 mb-4">
                下記メールアドレスまで直接ご連絡ください。
              </p>
              <a
                href="mailto:support@beekle.jp"
                class="text-primary-500 hover:text-primary-400 font-bold"
              >
                support@beekle.jp
              </a>
            </div>
            
            <!-- Phone -->
            <div class="bg-white rounded-xl shadow-lg p-8">
              <h3 class="text-xl font-bold text-gray-800 mb-4">お電話でのお問い合わせ</h3>
              <p class="text-gray-600 mb-4">
                平日 10:00〜18:00 にて対応しております。
              </p>
              <p class="text-primary-500 font-bold">090-6163-9203</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  .bg-grid-pattern {
    background-image: linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
  }
</style>


<script>
    const form = document.querySelector('form');
    const submitButton = form?.querySelector('button[type="submit"]');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = `
          <svg class="animate-spin h-5 w-5 mr-3 inline-block" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          送信中...
        `;
      }

      try {
        const formData = new FormData(form);
        const data = {
          name: formData.get('from_name'),
          email: formData.get('reply_to'),
          message: formData.get('message'),
          type: formData.get('type'),
          company: formData.get('company_name'),
          phone: formData.get('phone')
        };

        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          alert('お問い合わせを受け付けました。担当者より1-2営業日以内にご連絡いたします。');
          form.reset();
        } else {
          throw new Error('送信に失敗しました');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('エラーが発生しました。しばらく時間をおいて再度お試しください。');
      } finally {
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.innerHTML = '送信する';
        }
      }
    });
  </script>