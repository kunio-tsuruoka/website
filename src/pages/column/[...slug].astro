---
import { Header } from '../../components/header';
import Layout from '../../layouts/layout.astro';
import { marked } from 'marked';
import { getAllColumnIds, getColumn } from '../../lib/microcms';

export const prerender = true;

// 静的生成のためのパス生成
export async function getStaticPaths() {
  const columnIds = await getAllColumnIds();

  return columnIds.map((id: string) => ({
    params: { slug: id }
  }));
}

const { slug } = Astro.params;
const columnId = slug as string;

// MicroCMSから記事を取得
const column = await getColumn(columnId);

if (!column) {
  return Astro.redirect('/404');
}

// Markedの設定
marked.setOptions({
  breaks: true,
  gfm: true,
});

const htmlContent = marked(column.content || '');
const frontmatter = {
  title: column.title,
  publishedAt: new Date(column.publishedAt).toLocaleDateString('ja-JP'),
};

// 関連記事（仮データ）
const relatedArticles = [
  {
    title: '「見積もりが当てにならない」を防ぐ正しい見積もりの見方',
    slug: 'how-to-read-estimates',
    category: 'avoid-failure'
  },
  {
    title: '要件定義で失敗しないための実践チェックリスト',
    slug: 'requirement-checklist',
    category: 'avoid-failure'
  },
  {
    title: '無料PoCで効果検証する方法',
    slug: 'fast-development/01-free-poc-guide',
    category: 'fast-development'
  }
];
---

<Layout title={`${frontmatter.title} | Beekle`}>
  <Header client:load />
  <main class="pt-20">
    {/* Breadcrumb */}
    <section class="py-6 bg-gray-50 border-b border-gray-200">
      <div class="container mx-auto px-6 md:px-8">
        <nav class="flex items-center gap-2 text-sm text-gray-600">
          <a href="/" class="hover:text-primary-500 transition-colors">ホーム</a>
          <span>/</span>
          <a href="/column" class="hover:text-primary-500 transition-colors">コラム</a>
          <span>/</span>
          <span class="text-gray-900">{frontmatter.title}</span>
        </nav>
      </div>
    </section>

    {/* Article Header */}
    <section class="py-12 md:py-16 bg-gradient-to-br from-primary-50 to-primary-100">
      <div class="container mx-auto px-6 md:px-8 max-w-4xl">
        {/* Meta Info */}
        <div class="flex flex-wrap items-center gap-3 mb-6">
          <span class="text-sm text-gray-600">{frontmatter.publishedAt}</span>
        </div>

        {/* Title */}
        <h1 class="text-3xl md:text-5xl font-bold text-gray-900 leading-tight">
          {frontmatter.title}
        </h1>
      </div>
    </section>

    {/* Article Content */}
    <article class="py-16 md:py-20 bg-white">
      <div class="container mx-auto px-6 md:px-8 max-w-4xl">
        <div class="markdown-content">
          <Fragment set:html={htmlContent} />
        </div>
      </div>
    </article>

    {/* Back to Column List */}
    <section class="py-16 bg-white">
      <div class="container mx-auto px-6 md:px-8 max-w-4xl">
        <a
          href="/column"
          class="inline-flex items-center text-primary-500 hover:text-primary-600 font-semibold transition-colors group"
        >
          <svg class="w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          <span>コラム一覧に戻る</span>
        </a>
      </div>
    </section>

    {/* CTA Section */}
    <section class="py-20 bg-primary-500">
      <div class="container mx-auto px-6 md:px-8 max-w-4xl text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">
          この知識を実践してみませんか？
        </h2>
        <p class="text-xl text-white/90 mb-10">
          ゼロスタートなら、初期費用0円で動くプロトタイプを体験できます。
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/prooffirst"
            class="inline-flex items-center justify-center px-10 py-5 text-xl font-semibold text-primary-500 bg-white rounded-full hover:bg-gray-100 transition-all shadow-xl hover:shadow-2xl"
          >
            ゼロスタートを詳しく見る
            <svg class="w-6 h-6 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
            </svg>
          </a>
          <a
            href="/contact"
            class="inline-flex items-center justify-center px-10 py-5 text-xl font-semibold text-white bg-transparent border-2 border-white rounded-full hover:bg-white hover:text-primary-500 transition-all"
          >
            無料相談を予約する
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* マークダウンコンテンツのデザインシステム - Tailwind設定を使用 */
  .markdown-content {
    @apply text-gray-800 text-base leading-relaxed;
  }

  /* 見出しスタイル - 明確な階層を作る */
  .markdown-content :global(h1) {
    @apply font-bold text-gray-900 text-3xl md:text-4xl mt-8 mb-4;
  }

  .markdown-content :global(h2) {
    @apply font-bold text-gray-900 text-2xl md:text-3xl mt-10 mb-4 pb-2 border-b-[3px] border-primary-200;
  }

  .markdown-content :global(h3) {
    @apply font-bold text-gray-900 text-xl md:text-2xl mt-7 mb-3 relative pl-2;
  }

  .markdown-content :global(h3)::before {
    content: '';
    @apply absolute left-0 w-1 bg-gradient-to-b from-primary-500 to-primary-600 rounded;
    top: 0.35em;
    height: 1.2em;
  }

  .markdown-content :global(h4) {
    @apply font-bold text-gray-800 text-lg md:text-xl mt-5 mb-2;
  }

  .markdown-content :global(h5) {
    @apply font-bold text-gray-800 text-base md:text-lg mt-4 mb-2;
  }

  /* 段落スタイル - 読みやすい行間と余白 */
  .markdown-content :global(p) {
    @apply text-gray-700 text-base leading-relaxed mb-3;
  }

  /* リンクスタイル - 目立つがエレガント */
  .markdown-content :global(a) {
    @apply text-primary-500 font-medium no-underline;
    position: relative;
    transition: all 0.2s ease;
    border-bottom: 2px solid transparent;
  }

  .markdown-content :global(a):hover {
    @apply text-primary-600;
    border-bottom-color: currentColor;
  }

  .markdown-content :global(a)::after {
    content: '→';
    margin-left: 0.25rem;
    opacity: 0;
    transition: all 0.2s ease;
    display: inline-block;
  }

  .markdown-content :global(a):hover::after {
    opacity: 1;
    margin-left: 0.375rem;
  }

  /* 強調テキスト */
  .markdown-content :global(strong) {
    @apply font-bold text-primary-700;
    background: linear-gradient(180deg, transparent 60%, rgba(199, 210, 254, 0.4) 60%);
    padding: 0 0.2em;
  }

  .markdown-content :global(em) {
    @apply italic text-gray-700;
  }

  /* リストスタイル - 視覚的に明確 */
  .markdown-content :global(ul) {
    @apply my-4 pl-0 list-none;
  }

  .markdown-content :global(ul li) {
    @apply relative text-gray-700 text-base leading-relaxed pl-4 mb-2;
  }

  .markdown-content :global(ul li):last-child {
    @apply mb-0;
  }

  .markdown-content :global(ul li)::before {
    content: '';
    @apply absolute left-1 rounded-full;
    top: 0.65em;
    width: 6px;
    height: 6px;
    background: linear-gradient(135deg, #3D4DB7, #3544a4);
    box-shadow: 0 0 0 3px rgba(61, 77, 183, 0.1);
  }

  /* チェックリスト用のスタイル - ✅と❌のサポート */
  .markdown-content :global(ul li:has(> :first-child:is([style*="color: green"], [style*="✅"]))) {
    @apply pl-5;
  }

  .markdown-content :global(ul li:has(> :first-child:is([style*="color: green"], [style*="✅"])))::before {
    content: '✅';
    @apply left-1;
    font-size: 1.25rem;
    background: none;
    box-shadow: none;
    width: auto;
    height: auto;
    top: 0;
  }

  .markdown-content :global(ul li:has(> :first-child:is([style*="color: red"], [style*="❌"])))::before {
    content: '❌';
    @apply left-1;
    font-size: 1.25rem;
    background: none;
    box-shadow: none;
    width: auto;
    height: auto;
    top: 0;
  }

  /* 番号付きリスト */
  .markdown-content :global(ol) {
    @apply my-4 pl-0 list-none;
    counter-reset: item;
  }

  .markdown-content :global(ol li) {
    @apply relative text-gray-700 text-base leading-relaxed pl-10 mb-2;
    counter-increment: item;
  }

  .markdown-content :global(ol li):last-child {
    @apply mb-0;
  }

  .markdown-content :global(ol li)::before {
    content: counter(item);
    @apply absolute left-0 w-6 h-6 text-white rounded-full flex items-center justify-center font-bold text-xs;
    background: linear-gradient(135deg, #3D4DB7, #3544a4);
    top: 0.15em;
  }

  /* 引用ブロック */
  .markdown-content :global(blockquote) {
    @apply bg-gradient-to-r from-primary-50 to-primary-100 rounded-xl;
    margin-top: 40px;    /* 8 × 5 */
    margin-bottom: 40px; /* 8 × 5 */
    padding: 24px;       /* 8 × 3 */
    border-left: 4px solid #3D4DB7;
    font-style: italic;
    position: relative;
  }

  .markdown-content :global(blockquote)::before {
    content: '"';
    position: absolute;
    top: -8px;           /* 8 × -1 */
    left: 16px;          /* 8 × 2 */
    font-size: 4rem;
    color: rgba(61, 77, 183, 0.2);
    font-family: Georgia, serif;
    line-height: 1;
  }

  .markdown-content :global(blockquote p) {
    @apply text-gray-700 mb-0;
  }

  /* コードブロック */
  .markdown-content :global(code) {
    @apply bg-gray-100 text-primary-500 rounded;
    padding: 4px 8px;    /* 上下4px (0.5×8), 左右8px (1×8) */
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 14px;     /* 本文より少し小さく */
  }

  .markdown-content :global(pre) {
    @apply bg-gray-900 text-gray-100 rounded-xl overflow-x-auto shadow-lg;
    margin-top: 40px;    /* 8 × 5 */
    margin-bottom: 40px; /* 8 × 5 */
    padding: 24px;       /* 8 × 3 */
  }

  .markdown-content :global(pre code) {
    @apply bg-transparent text-gray-100;
    padding: 0;
  }

  /* テーブル */
  .markdown-content :global(table) {
    @apply w-full border-collapse rounded-lg overflow-hidden shadow-md;
    margin-top: 40px;    /* 8 × 5 */
    margin-bottom: 40px; /* 8 × 5 */
  }

  .markdown-content :global(thead) {
    @apply bg-gradient-to-r from-primary-500 to-primary-600;
  }

  .markdown-content :global(th) {
    @apply text-left text-white font-bold;
    padding: 16px;       /* 8 × 2 */
    font-size: 16px;
  }

  .markdown-content :global(td) {
    @apply border-t border-gray-200 text-gray-700;
    padding: 16px;       /* 8 × 2 */
    font-size: 16px;
    line-height: 1.5;
  }

  .markdown-content :global(tbody tr):hover {
    @apply bg-primary-50;
  }

  /* 画像 */
  .markdown-content :global(img) {
    @apply rounded-xl shadow-lg mx-auto;
    margin-top: 40px;    /* 8 × 5 */
    margin-bottom: 40px; /* 8 × 5 */
    max-width: 100%;
    height: auto;
  }

  /* 水平線 */
  .markdown-content :global(hr) {
    @apply border-0;
    margin-top: 64px;    /* 8 × 8 */
    margin-bottom: 64px; /* 8 × 8 */
    height: 1px;
    background: linear-gradient(90deg, transparent, #e0e7ff, transparent);
  }

  /* カスタムボックススタイル（もし使われていれば） */
  .markdown-content :global(div[style*="background"]) {
    @apply rounded-xl;
    padding: 24px;       /* 8 × 3 */
    margin-top: 32px;    /* 8 × 4 */
    margin-bottom: 32px; /* 8 × 4 */
  }

  /* CTAボタンスタイル */
  .markdown-content :global(a[href^="/prooffirst"]),
  .markdown-content :global(a[href^="/contact"]) {
    @apply inline-flex items-center bg-gradient-to-r from-primary-500 to-primary-600 text-white font-bold rounded-full no-underline;
    padding: 12px 24px;  /* 上下12px (1.5×8), 左右24px (3×8) */
    transition: all 0.3s ease;
    border-bottom: none;
  }

  .markdown-content :global(a[href^="/prooffirst"])::after,
  .markdown-content :global(a[href^="/contact"])::after {
    content: none;
  }

  .markdown-content :global(a[href^="/prooffirst"]:hover),
  .markdown-content :global(a[href^="/contact"]:hover) {
    @apply shadow-xl;
    transform: translateY(-2px);
  }
</style>
