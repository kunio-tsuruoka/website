---
import { Header } from '../components/header';
import { PageHero } from '../components/ui/page-hero';
import Layout from '../layouts/layout.astro';
import { getCategories, getColumns } from '../lib/microcms';

// SSR: リクエスト時にMicroCMSから取得
const categories = await getCategories();
const allColumns = await getColumns();

// カテゴリーごとに記事を収集
const columnCategories = categories
  .map((category) => {
    const categoryColumns = allColumns.filter((column) => column.category.id === category.id);

    const articles = categoryColumns.map((column, index) => ({
      number: String(index + 1).padStart(2, '0'),
      title: column.title,
      slug: column.id,
    }));

    return {
      id: category.id,
      title: category.title,
      description: category.description,
      icon: category.icon,
      order: category.order,
      articles,
    };
  })
  .sort((a, b) => a.order - b.order);

// 統計情報
const totalArticles = columnCategories.reduce((sum, cat) => sum + cat.articles.length, 0);
---

<Layout title="コラムで学ぶ - システム開発を成功させる発注側の技術 | Beekle">
  <Header client:load />
  <main class="pt-20">
    {/* Hero Section */}
    <PageHero
      title="コラムで学ぶ システム開発の知識"
      subtitle="「開発って、正直よくわからない」という不安を解消。失敗しないための実践的な知識を、体系的にお届けします。"
      badge="Knowledge Base"
    >
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="#categories"
          class="inline-flex items-center justify-center px-8 py-4 text-lg font-medium text-primary-500 bg-white rounded-full hover:bg-gray-100 transition-all shadow-lg hover:shadow-xl"
        >
          記事を読む
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </a>
        <a
          href="/prooffirst"
          class="inline-flex items-center justify-center px-8 py-4 text-lg font-medium text-white bg-transparent border-2 border-white rounded-full hover:bg-white hover:text-primary-500 transition-all"
        >
          ゼロスタートを見る
        </a>
      </div>
    </PageHero>

    {/* Column Categories */}
    <section id="categories" class="py-16 md:py-24 bg-gradient-to-br from-gray-50 to-white">
      <div class="container mx-auto px-6 md:px-8">
        {columnCategories.map((category) => (
          <div id={category.id} class="mb-20 scroll-mt-24">
            {/* Category Header */}
            <div class="mb-12">
              <div class="flex items-center gap-4 mb-4">
                {/* Category Icon */}
                <div class="w-16 h-16 flex-shrink-0 rounded-2xl bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-lg">
                  {category.id === 'avoid-failure' && (
                    <svg class="w-9 h-9 text-white" viewBox="0 0 512 512" fill="currentColor">
                      <path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/>
                    </svg>
                  )}
                  {category.id === 'common-issues' && (
                    <svg class="w-9 h-9 text-white" viewBox="0 0 512 512" fill="currentColor">
                      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>
                    </svg>
                  )}
                  {category.id === 'fast-development' && (
                    <svg class="w-9 h-9 text-white" viewBox="0 0 512 512" fill="currentColor">
                      <path d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM256 416c35.3 0 64-28.7 64-64c0-17.4-6.9-33.1-18.1-44.6L366.4 161c5.7-12.1 .6-26.3-11.4-32s-26.3-.6-32 11.4L258.6 286.8c-2.5-.4-5-.8-7.6-.8c-35.3 0-64 28.7-64 64s28.7 64 64 64z"/>
                    </svg>
                  )}
                  {category.id === 'beekle-knowhow' && (
                    <svg class="w-9 h-9 text-white" viewBox="0 0 512 512" fill="currentColor">
                      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/>
                    </svg>
                  )}
                  {category.id === 'selecting-tech-partner' && (
                    <svg class="w-9 h-9 text-white" viewBox="0 0 640 512" fill="currentColor">
                      <path d="M323.4 85.2l-96.8 78.4c-16.1 13-19.2 36.4-7 53.1c12.9 17.8 38 21.3 55.3 7.8l99.3-77.2c7-5.4 17-4.2 22.5 2.8s4.2 17-2.8 22.5l-20.9 16.2L512 316.8V128h-.7l-3.9-2.5L434.8 79c-15.3-9.8-33.2-15-51.4-15c-21.8 0-43 7.5-60 21.2zm22.8 124.4l-51.7 40.2C263 274.4 217.3 268 193.7 235.6c-22.2-30.5-16.6-73.1 12.7-96.8l83.2-67.3c-11.6-4.9-24.1-7.4-36.8-7.4C234 64 215.7 69.6 200 80l-72 48V352h28.2l91.4 83.4c19.6 17.9 49.9 16.5 67.8-3.1c5.5-6.1 9.2-13.2 11.1-20.6l17 15.6c19.5 17.9 49.9 16.6 67.8-2.9c4.5-4.9 7.8-10.6 9.9-16.5c19.4 13 45.8 10.3 62.1-7.5c17.9-19.5 16.6-49.9-2.9-67.8l-134.2-123zM16 128c-8.8 0-16 7.2-16 16V352c0 17.7 14.3 32 32 32H64c17.7 0 32-14.3 32-32V128H16zM48 320a16 16 0 1 1 0 32 16 16 0 1 1 0-32zM544 128V352c0 17.7 14.3 32 32 32h32c17.7 0 32-14.3 32-32V144c0-8.8-7.2-16-16-16H544zm32 208a16 16 0 1 1 32 0 16 16 0 1 1 -32 0z"/>
                    </svg>
                  )}
                </div>

                <div class="flex-1">
                  <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
                    {category.title}
                  </h2>
                  <p class="text-lg text-gray-600">
                    {category.description}
                  </p>
                </div>
              </div>
              <div class="border-t-2 border-primary-200"></div>
            </div>

            {/* Articles Grid */}
            {category.articles.length > 0 ? (
              <div class="grid md:grid-cols-2 gap-6">
                {category.articles.map((article) => (
                  <a
                    href={`/column/${article.slug}`}
                    class="group bg-white rounded-2xl shadow-md hover:shadow-xl transition-all p-6 md:p-8 border border-gray-100 hover:border-primary-200"
                  >
                    <div class="flex items-start gap-6">
                      {/* Article Number */}
                      <div class="flex-shrink-0">
                        <div class="w-14 h-14 flex items-center justify-center rounded-full bg-gradient-to-br from-primary-100 to-primary-200 text-primary-600 font-bold text-lg">
                          {article.number}
                        </div>
                      </div>

                      {/* Article Content */}
                      <div class="flex-1 min-w-0">
                        <h3 class="text-xl font-bold text-gray-900 group-hover:text-primary-500 transition-colors mb-4 leading-tight">
                          {article.title}
                        </h3>

                        {/* Read More */}
                        <div class="flex items-center text-primary-500 font-semibold text-sm group-hover:translate-x-1 transition-transform">
                          <span>記事を読む</span>
                          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                          </svg>
                        </div>
                      </div>
                    </div>
                  </a>
                ))}
              </div>
            ) : (
              <div class="text-center py-12 bg-gray-50 rounded-xl">
                <p class="text-gray-500">このカテゴリーの記事はまだありません</p>
              </div>
            )}
          </div>
        ))}
      </div>
    </section>

    {/* Quick Navigation */}
    <section class="py-12 bg-white border-y border-gray-200">
      <div class="container mx-auto px-6 md:px-8">
        <h3 class="text-xl font-bold text-gray-900 mb-6 text-center">カテゴリーから探す</h3>
        <div class="flex flex-wrap justify-center gap-4">
          {columnCategories.map((category) => (
            <a
              href={`#${category.id}`}
              class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary-50 to-primary-100 hover:from-primary-100 hover:to-primary-200 text-primary-600 rounded-full font-medium transition-all shadow-sm hover:shadow-md"
            >
              <span>{category.title}</span>
            </a>
          ))}
        </div>
      </div>
    </section>

    {/* Templates & Checklists */}
    <section class="relative py-20 md:py-28 bg-accent-950 text-white overflow-hidden">
      <div class="absolute inset-0 bg-grid-pattern opacity-20"></div>

      <div class="container mx-auto px-6 md:px-8 relative">
        <div class="max-w-3xl mx-auto text-center mb-16">
          <span class="inline-flex items-center px-4 py-2 mb-6 bg-white/10 backdrop-blur-sm rounded-full text-sm font-medium">
            Templates & Checklists
          </span>
          <h2 class="text-3xl md:text-4xl font-bold mb-4">型・テンプレート・チェックリスト</h2>
          <p class="text-lg text-white/80 leading-relaxed">
            実務でそのまま使えるドキュメントの型や、開発の抜け漏れを防ぐチェックリストを準備中です。
            公開まで今しばらくお待ちください。
          </p>
        </div>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          <div
            class="group relative block rounded-2xl bg-white/10 hover:bg-white/15 transition-all p-8 shadow-xl hover:shadow-2xl border border-white/10 cursor-not-allowed"
            aria-disabled="true"
          >
            <div class="flex items-start justify-between mb-6">
              <span class="px-3 py-1 text-xs font-semibold rounded-full bg-white/20 text-white/90 border border-white/20">
                準備中
              </span>
            </div>

            <h3 class="text-2xl font-semibold mb-3 group-hover:text-white">要件定義テンプレート集</h3>
            <p class="text-sm text-white/80 leading-relaxed mb-6">
              要件整理からスコープ合意までをスムーズに進めるためのドキュメントセット。
              公開後はチェックリスト付きで利用できます。
            </p>

            <div class="absolute inset-0 rounded-2xl border border-white/0 group-hover:border-white/40 transition-colors"></div>
          </div>

          <div
            class="group relative block rounded-2xl bg-white/10 hover:bg-white/15 transition-all p-8 shadow-xl hover:shadow-2xl border border-white/10 cursor-not-allowed"
            aria-disabled="true"
          >
            <div class="flex items-start justify-between mb-6">
              <span class="px-3 py-1 text-xs font-semibold rounded-full bg-white/20 text-white/90 border border-white/20">
                準備中
              </span>
            </div>

            <h3 class="text-2xl font-semibold mb-3 group-hover:text-white">開発プロセス・チェックリスト</h3>
            <p class="text-sm text-white/80 leading-relaxed mb-6">
              プロジェクトの立ち上げからリリース後の運用まで、フェーズごとの確認ポイントを網羅予定です。
            </p>

            <div class="absolute inset-0 rounded-2xl border border-white/0 group-hover:border-white/40 transition-colors"></div>
          </div>

          <div
            class="group relative block rounded-2xl bg-white/10 hover:bg-white/15 transition-all p-8 shadow-xl hover:shadow-2xl border border-white/10 cursor-not-allowed"
            aria-disabled="true"
          >
            <div class="flex items-start justify-between mb-6">
              <span class="px-3 py-1 text-xs font-semibold rounded-full bg-white/20 text-white/90 border border-white/20">
                準備中
              </span>
            </div>

            <h3 class="text-2xl font-semibold mb-3 group-hover:text-white">マネジメント・ドキュメントセット</h3>
            <p class="text-sm text-white/80 leading-relaxed mb-6">
              プロジェクト計画書やステークホルダー連絡テンプレートなど、進行管理を支える資料を順次公開予定です。
            </p>

            <div class="absolute inset-0 rounded-2xl border border-white/0 group-hover:border-white/40 transition-colors"></div>
          </div>
        </div>
      </div>
    </section>

    {/* CTA Section - Zero Start */}
    <section class="relative py-20 md:py-32 overflow-hidden bg-gradient-to-br from-primary-500 to-primary-600">
      <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>

      <div class="container mx-auto px-6 md:px-8 relative">
        <div class="max-w-4xl mx-auto text-center">
          <h2 class="text-3xl md:text-5xl font-bold text-white mb-6">
            知識を得たら、次は<br class="md:hidden" />
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-pink-200">実際に体験しませんか？</span>
          </h2>

          <p class="text-xl text-white/90 mb-10 leading-relaxed">
            コラムで学んだ「失敗しない開発」を、ゼロスタートで実践。<br />
            初期費用0円で、動くプロトタイプを体験できます。
          </p>

          <div class="bg-white/10 backdrop-blur-sm rounded-3xl p-8 mb-10">
            <div class="grid md:grid-cols-3 gap-6 text-white">
              <div>
                <div class="text-4xl font-bold mb-2">0円</div>
                <div class="text-white/80">初期費用</div>
              </div>
              <div>
                <div class="text-4xl font-bold mb-2">1-2週間</div>
                <div class="text-white/80">プロトタイプ完成</div>
              </div>
              <div>
                <div class="text-4xl font-bold mb-2">動くデモ</div>
                <div class="text-white/80">で判断できる</div>
              </div>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a
              href="/prooffirst"
              class="inline-flex items-center justify-center px-10 py-5 text-xl font-semibold text-primary-500 bg-white rounded-full hover:bg-gray-100 transition-all shadow-xl hover:shadow-2xl hover:scale-105 transform"
            >
              ゼロスタートについて詳しく見る
              <svg class="w-6 h-6 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
            <a
              href="/contact"
              class="inline-flex items-center justify-center px-10 py-5 text-xl font-semibold text-white bg-transparent border-2 border-white rounded-full hover:bg-white hover:text-primary-500 transition-all"
            >
              無料相談を予約する
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  @keyframes float {
    0%, 100% { transform: translateY(0) }
    50% { transform: translateY(-20px) }
  }

  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  .animate-float-delay {
    animation: float 8s ease-in-out infinite;
    animation-delay: 1s;
  }

  .bg-grid-pattern {
    background-image: linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 20px 20px;
  }

  .scroll-mt-24 {
    scroll-margin-top: 6rem;
  }
</style>
